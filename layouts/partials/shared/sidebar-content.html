{{ $page := . }}
{{ with .Scratch.Get "sidebar" }}

{{ if .image }}<img src="{{ .image | relURL }}" class="db ma0">{{ end }}
<div class="blog-info pa4">
  {{ if .title }}<h1 class="f3">{{ .title }}</h1>{{ end }}
  {{ if .description }}<p class="f6 lh-copy measure">{{ .description | markdownify }}</p>{{ end }}
  {{ if .author }}<p class="f7 measure lh-copy i mh0-l">Written by {{ .author }}</p>{{ end }}
  {{ if .text_link_label }}<small class="db f7"><a href="{{ .text_link_url }}" class="dib fw7 ttu bt bw1 b--black-10 pt3">{{ .text_link_label }}</a></small>{{ end }}
</div>

{{ if or .show_sidebar_toc .show_sidebar_adunit }}
<div class="ad-unit pa4">
{{ if .show_sidebar_toc }}
  {{ $headers := findRE "<h[2].*>" $page.Content }}
  {{- $has_headers := ge (len $headers) 1 -}}
  {{- if $has_headers -}}
  <p class="f6 measure-narrow lh-copy mb2">
    <span class="b ttu db">On this page</span>
    <span>{{ $page.TableOfContents }}</span>
  </p>
  {{- end -}}
{{ end }}
{{ if .show_sidebar_adunit }}
  {{ range $.Site.Data.ads }}
  <p class="f7 measure-narrow lh-copy mv0"><span class="b ttu db">{{ .title }}</span><span>{{ .body | markdownify }}</span></p>
  {{ end }}
{{ end }}
</div>
{{ end }}

{{ if eq $page.Params.layout "single-series" }}
<div class="flex items-start ad-unit">
  <div class="w-50 pl4 pr0 mr2">
    <h3 class="f3 mt3">{{ .text_series_label }}</h3>
    {{ $series := index ($page.Params.series) 0 | urlize }}
    {{ $taxonomy :=  $.Site.GetPage (printf "/series/%s" $series) }}
    <nav id="SeriesTableOfContents">
        <ul>
        {{ range $taxonomy.Pages }}
          {{ $active := eq .RelPermalink $page.RelPermalink }}
        <li class="{{ if $active }}bt bb b--dotted bw1 bg-near-white{{ end }} pv1" hugo-nav="{{ .RelPermalink }}"><a href="{{ .Permalink }}">{{ .LinkTitle }}</a></li>
        {{ end }}
        </ul>
      </nav>
  </div>
  <div class="outline w-50 pl3 pr0 ml0 mr2 bg-near-white">
    <h3 class="f3 mt3">{{ .text_contents_label }}</h3>
    {{ $page.TableOfContents }}
  </div>
{{ end }}
{{ end }}
