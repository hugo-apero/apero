{{ $permalink := .Permalink }}
{{ $page := . }}

<!--meta tags-->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
{{ hugo.Generator }}
<title>{{ if .IsHome }}{{ .Title }}{{ else }}{{ .Page.Title }} | {{ .Site.Title }}{{ end }}</title>
<meta name="description" content="{{ .Description }}" />
{{- $site_card := printf "%s" .Site.Params.sharing_image | absURL }}

<!--opengraph tags-->
<meta property="og:title" content="{{ .Title }} - {{ .Site.Title }}">
<meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{if .IsPage}}{{ .Params.excerpt }}{{ end }}{{ end }}" />
<meta property="og:type" content="{{ if .IsPage }}page{{ else }}website{{ end }}" />
<meta property="og:url" content="{{ .Permalink }}" />

<!--sharing images-->
<!--adapted from: https://github.com/kaushalmodi/hugo-bare-min-theme/blob/6195b5e377c56791ba4067ac0ec5286bf336aedf/layouts/partials/twitter_cards.html-->
{{/* If images are specified as list variable in section front matter. */}}
{{- with $.Params.images -}}
    <meta name="twitter:card" content="summary_large_image"/>
    {{- $image := (index . 0) -}}
    {{- $image_link_absolute := (findRE "^/" $image) -}}
    {{- if $image_link_absolute -}}
        <meta name="twitter:image" content="{{- $image | absURL -}}"/>
    {{- else -}}
        <meta name="twitter:image" content="{{- (printf "%s%s" $permalink $image) -}}"/>
    {{- end -}}
{{ end }}
    
<!--using featured images-->
{{ if .IsPage -}}
    {{/* If images are featured in a page's bundle. */}}
    {{- $images := $.Resources.ByType "image" -}}
    {{- $featured := $images.GetMatch "*feature*" -}}
    {{- $hex := $images.GetMatch "*hex*" -}}
    {{- $card := cond (ne $hex nil) $hex $featured -}}
    
    {{/* Or if images are featured in a taxonomy term's bundle. */}}
    {{ if $page.Params.series }}
        {{- $term := index ($page.Params.series) 0 | urlize -}}
        {{- $series := $.Site.GetPage "taxonomyTerm" (printf "/%s/%s" "series" $term) -}}
        {{- $featured := $series.Resources.GetMatch "*feature*" -}}
        {{ $.Scratch.Set "$sf" $featured }}
    {{ end }}
    
    {{ $series_featured := $.Scratch.Get "$sf" }}
    {{- $card := cond (ne $series_featured nil) $series_featured $card -}}
    {{ with $card }}
        <meta property="og:image" content="{{ .Permalink }}" >
        <meta property="twitter:card" content="{{ if (ne $hex nil) }}summary{{ else }}summary_large_image{{ end }}">
        <meta name="twitter:image" content="{{ .Permalink }}" >
    {{/* If not featured, use the site card. */}}
    {{ else }}
        <meta property="og:image" content="{{ $site_card }}" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="{{ $site_card }}" >
    {{ end }}
{{ end }}

<!--home page-->
{{ if .IsHome }}
  <meta property="og:title" content="{{ .Site.Title }}">
  <meta property="description" content="{{ .Site.Params.description }}">
  <meta property="og:description" content="{{ .Site.Params.description }}">
  <!--use image from site config param-->
  {{ $og_image := printf "%s" .Site.Params.sharing_image | absURL }}
  {{- with $og_image -}}
      <meta property="og:image" content="{{ . }}" >
      <meta property="twitter:card" content="summary_large_image">
      <meta name="twitter:image" content="{{ . }}" >
  {{- end -}}
{{- end -}}